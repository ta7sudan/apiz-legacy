/**
 * @Version 0.1.0
 * @Author: ta7sudan
 * @Repo: https://github.com/ta7sudan/apiz-legacy#readme
 * @License: MIT
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var globalQuerystring,globalParamRegex,globalClient,defaultType,toString=Map.call.bind(Object.prototype.toString),isStr=function(e){return e&&"string"==typeof e},isFn=function(e){return"function"==typeof e},isObj=function(e){return"[object Object]"===toString(e)},defaultParamRegex=/:((\w|-)+)/g,slashRegex=/\/\//g,replaceSlash=function(e,r){return r<=6?e:"/"};function isAPIInfoWithURL(e){return!!e.url}function parseApiInfo(e,r,t){var n,i,o,a=t.baseURL,s=t.paramRegex,l=t.querystring,u=t.client,c=r.method,p=void 0===c?"GET":c,f=r.type,g=void 0===f?defaultType:f,d=r.meta;if("add"===e)throw new Error('"add" is preserved key.');isAPIInfoWithURL(r)?n=r.url:(i=r.baseURL,o=r.path);var y={},h=i||a;if(!isObj(r))throw new TypeError("API "+e+" expected an object, but received "+JSON.stringify(r)+".");if(isStr(n))y.url=n;else{if(!isStr(h))throw new Error('API "'+e+'" must set url or baseURL correctly.');y.url=(h+(o||"")).replace(slashRegex,replaceSlash)}var b=p.toUpperCase(),m=p.toLowerCase();if(-1===["GET","HEAD","POST","PUT","PATCH","DELETE","OPTIONS"].indexOf(b))throw new Error("Unsupported HTTP method: "+b+".");if(!isFn(u[m]))throw new Error("client must implement a "+m+" function.");var v=y.url.split(/\/(?=\w|:)/g),P=/^(https?:|\/)/.test(v[0])?2:1;return y.baseURL=v.slice(0,P).join("/"),y.path="/"+v.slice(P).join("/"),y.name=e,y.meta=d,y.method=b,y.methodLowerCase=m,y.client=u,y.type=g,y.regex=s,y.querystring=l,y.init=!0,y}function replaceParams(t){return function(e,r){if(null==t[r])throw new Error("Can't find a property \""+r+'" in params.');return encodeURIComponent(t[r])}}function request(e,r){var t,n=this.methodLowerCase,i=this.type,o=this.regex,a=this.querystring,s=this.baseURL,l=this.path,u=this.client,c=this.meta,p=e||{},f=p.query,g=p.params,d=p.body,y=p.headers,h=p.type,b=p.handleError,m=this.url;return!0===r?u[n]({url:m,name:this.name,handleError:b,options:e}):(void 0===h&&(h=i),g&&(m=s+l.replace(o,replaceParams(g))),f&&(t=a(f),m=-1!==m.indexOf("?")?m+"&"+t:m+"?"+t),u[n]({url:m,name:this.name,handleError:b,meta:c,type:h,body:d,headers:y,query:f}))}function createAPI(r){var t=request.bind(r);return["url","method","meta","type"].forEach(function(e){Object.defineProperty(t,e,{value:r[e],enumerable:!0,writable:!0})}),t}function APIz(e,r){var t,n,i,o,a=this instanceof APIz?this:Object.create(APIz.prototype);isStr(e.baseURL)&&(t=e.baseURL);var s=r||{},l=s.baseURL;t=void 0===l?t:l;var u=s.paramRegex;n=void 0===u?globalParamRegex||defaultParamRegex:u;var c=s.querystring,p=s.client;if(o=void 0===p?globalClient:p,!isFn(i=void 0===c?globalQuerystring:c))throw new Error("A querystring function must set.");if(!o)throw new Error("A client must set.");var f={baseURL:t,paramRegex:n,querystring:i,client:o},g=e.apis;for(var d in g)if(isObj(g[d])){var y=parseApiInfo(d,g[d],f);Object.defineProperty(a,d,{value:createAPI(y),writable:!1})}else console.warn("The "+d+" in group is not an object.");return a.add=function(e,r){if(this[e])throw new Error('API "'+e+'" already exists.');var t=parseApiInfo(e,r,f);return this[e]=createAPI(t),this},a}function config(e){var r=void 0===e?{reset:!0}:e,t=r.querystring,n=r.paramRegex,i=r.client,o=r.reset,a=r.defaultType;isFn(t)&&(globalQuerystring=t),n instanceof RegExp&&(globalParamRegex=n),globalClient=i,defaultType=a,o&&(globalQuerystring=globalParamRegex=globalClient=defaultType=void 0)}var querystring=function(e){return"[object Object]"===Object.prototype.toString.call(e)?Object.keys(e).map(function(r){return Array.isArray(e[r])?e[r].map(function(e){return encodeURIComponent(r)+"="+encodeURIComponent(null==e?"":e)}).join("&"):encodeURIComponent(r)+"="+encodeURIComponent(null==e[r]?"":e[r])}).join("&"):"string"==typeof e?e:JSON.stringify(e)};config({querystring:querystring,defaultType:"json"}),exports.APIz=APIz,exports.config=config;
//# sourceMappingURL=apiz.cjs.js.map
